<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cms.sample.mapper.employee.CmsEmployeeMapper">
	<select id="selectMaxId" resultType="String">
        SELECT 
        IFNULL(MAX(CONVERT(employeeId, SIGNED INTEGER)),'1') 
        FROM cms_employee;
	</select>

	<select id="selectRecordCount"
        parameterType="com.cms.sample.entity.employee.CmsEmployeeBean"
        resultType="Integer">
        SELECT
        count(employeeId) as recCount
        FROM cms_employee
        where 1 = 1
        <if test="employeeId != null">
        	and employeeId = #{employeeId}
        </if>
        <if test="employeeName != null">
        	and employeeName like concat('%',#{employeeName},'%')
        </if>
        <if test="updateDay != null">
        	and DATE_FORMAT(updateDay, '%Y-%m-%d %H:%i:%s') = #{updateDay}
        </if>
	</select>

	<select id="select"
        parameterType="com.cms.sample.entity.employee.CmsEmployeeBean"
        resultType="com.cms.sample.entity.employee.CmsEmployeeBean">
        SELECT
        cms.*,
        com.companyName as companyName,
        cms.departmentID as departmentID,
        dep.departmentName as departmentName,
        mst.generalName as sexForList
        FROM
		cms_pg.cms_employee cms
    	left join cms_pg.cms_company com on cms.companyID=com.companyId
    	left join cms_pg.cms_department dep on cms.departmentID=dep.departmentId
    	left join cms_pg.cms_general_mst mst on cms.sex=mst.generalId
 	   								 and mst.generalKey='SEXY'
        <where>
        <if test="employeeId != null">
        	and employeeId = #{employeeId}
        </if>
        <if test="employeeName != null">
        	and employeeName like concat('%',#{employeeName},'%')
        </if>
        <if test="sex!= null">
        	and sex = #{sex}
        </if>
        <if test="companyName!= null">
        	and companyName like concat('%',#{companyName},'%')
        </if>
        <if test="departmentName!= null">
        	and dep.departmentName = #{departmentName}
        </if>
        <if test="birthday != null">
        <![CDATA[
        	and birthday >= date_add(DATE_FORMAT(#{birthday}, '%Y-%m-%d'),interval -day(DATE_FORMAT(#{birthday}, '%Y-%m-%d'))+1 day)
        	and birthday < last_day(DATE_FORMAT(#{birthday}, '%Y-%m-%d'))
        	]]>
        </if>
        <if test="loginId != null">
        	and loginId = #{loginId}
        </if>
        </where>
	</select>

	<select id="selectList" parameterType="com.cms.sample.entity.employee.CmsEmployeeBean"
		resultType="com.cms.sample.entity.employee.CmsEmployeeBean">
		SELECT
		*
		FROM
		cms_employee
		<where>
			<if test="employeeId != null">
				employeeId = #{employeeId}
			</if>
			<if test="name != null">
				name = #{name}
			</if>
		</where>
	</select>
	
	<select id="selectCompany" parameterType="com.cms.sample.entity.company.CmsCompanyBean"
        resultType="com.cms.sample.entity.company.CmsCompanyBean">
		SELECT
		    com.companyId,
		    com.companyName
		FROM
		    cms_pg.cms_company com
		<where>
			com.companyName like concat('%',#{companyName},'%')
		</where> 
	</select>

	
	<insert id="insert" parameterType="com.cms.sample.entity.employee.CmsEmployeeBean">
        INSERT INTO cms_pg.cms_employee (
	        employeeId,
		    employeeName,
		    sex,
		    birthday,
		    address,
		    phone,
		    joiningDate,
		    mail,
		    jobType,
		    jobStatus,
		    delFlg,
		    departmentName,
		    departmentID,
		    companyID,
		    loginId,
		    password,
		    permissonID,
		    registDay,
		    updateDay,
		    u_name,
		    u_address,
		    u_phone,
		    relationship
        )
        VALUES (
	        #{employeeId},
	        #{employeeName},
	        #{sex},
	        STR_TO_DATE(#{birthday}, '%Y-%m-%d'),
	        #{address},
	        #{phone},
	        STR_TO_DATE(#{joiningDate}, '%Y-%m-%d'),
	        #{mail},
	        #{jobType},
	        #{jobStatus},
	        #{delFlg},
	        #{departmentName},
	        #{departmentID},
	        #{companyID},
	        #{loginId},
	        #{password},
	        #{permissonID},
	        sysdate(),
	        sysdate(),
	        #{u_name},
	        #{u_address},
	        #{u_phone},
	        #{relationship}
        )
	</insert>

	<update id="update" parameterType="com.cms.sample.entity.employee.CmsEmployeeBean">
		update cms_employee set
			employeeName = #{employeeName},
			sex = #{sex},
			mail = #{mail},
			birthday = STR_TO_DATE(#{birthday}, '%Y-%m-%d'),
			phone = #{phone},
			address = #{address},
			departmentID = #{departmentID},
			companyID = #{companyID},
			joiningDate = STR_TO_DATE(#{joiningDate}, '%Y-%m-%d'),
			jobType = #{jobType},
			u_name = #{u_name},
			u_address = #{u_address},
			u_phone = #{u_phone},
			relationship = #{relationship},
			updateDay =sysdate()
		where employeeId = #{employeeId}
	</update>

	<delete id="delete" parameterType="com.cms.sample.entity.employee.CmsEmployeeBean">
        delete from cms_employee
        where employeeId = #{employeeId}
	</delete>

	<delete id="deleteAll">
        delete from cms_employee where employeeId in
        <foreach collection="array" open="(" close=")" item="item"
        	separator=",">
        	#{item}
        </foreach>
	</delete>
</mapper>